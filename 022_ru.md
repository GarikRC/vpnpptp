В версии vpnpptp 0.2.2 реализовано:

1) добавлена поддержка openSUSE,

2) в openSUSE в скрипты директории /etc/ppp/ip-up.d/ и директории /etc/ppp/ip-down.d/ передаются переменные IFNAME вместо PPP\_IFACE, IPREMOTE вместо PPP\_REMOTE, вместо пакета pptp-linux используется пакет pptp, учтено,

3) переписан алгоритм определения произошел ли запуск при поднятом VPN, так как ранее проверялось есть ли pppN и дефолтный ли он, то теперь проверяется лишь наличие pppN, так как он может и не быть дефолтным,

4) в openSUSE встроенная в дистрибутив реализация работы с usepeerdns не устроила, так как полученные от VPN-сервера DNS1 при поднятом VPN, DNS2 при поднятом VPN имели низкий приоритет для не dsl-соединений, а наше VPN-соединение не является dsl-соединением, так как используется интерфейс pppN, а не dslN, поэтому я внес дополнения:

если дистрибутив openSUSE, то в скрипт /etc/ppp/ip-up.d/ip-up вписывается:

cp -f /var/run/ppp/resolv.conf.copy /var/run/ppp/resolv.conf #эта строчка вписывается только если не выбрана опция usepeerdns

if [$USEPEERDNS = "1" ](.md)

then

> [-n "$DNS1" ](.md) && rm -f /var/run/ppp/resolv.conf

> [-n "$DNS2" ](.md) && rm -f /var/run/ppp/resolv.conf

> [-n "$DNS1" ](.md) && echo "nameserver $DNS1" >> /var/run/ppp/resolv.conf

> [-n "$DNS2" ](.md) && echo "nameserver $DNS2" >> /var/run/ppp/resolv.conf

fi

потом уже следующими действиями файл /etc/resolv.conf заменяется файлом /var/run/ppp/resolv.conf с сохранением копии файла /etc/resolv.conf для возврата назад,

5) в скрипт /etc/ppp/ip-down.d/ip-down для openSUSE независимо от выбора опции usepeerdns дописывается для возврата DNS до поднятия VPN:

netconfig update -f

if [-a /etc/resolv.conf.netconfig ](.md)

then

> cp -f /etc/resolv.conf.netconfig /etc/resolv.conf

> rm -f /etc/resolv.conf.netconfig

fi

Если в момент выполнения скрипта /etc/ppp/ip-down.d/ip-down окажется, что в файле /etc/resolv.conf произошли изменения нами, то команда netconfig update -f создаст файл /etc/resolv.conf.netconfig, которым нами будет заменен файл /etc/resolv.conf,

6) ранее при старте конфигуратора проверялось наличие дефолтного шлюза, и если его не было, то исправлялось автоматически, но автоматическое исправление в самом конфигураторе не всегда возможно, что бывает для openSUSE, поэтому добавлена обработка ошибки автоматического создания дефолтного шлюза при старте конфигуратора, и выводятся советы пользователю по решению этой задачи - предлагается вручную указать сетевой интерфейс и шлюз локальной сети, а конфигуратор сам добавит необходимый дефолтный маршрут,

7) получение маршрутов в openSUSE через DHCP уже реализовано в дистрибутиве,

8) учитывая, что в дистрибутиве openSUSE не настроен корректный запуск графических программ, требующих административных привилегий, через sudo, а также то, что используется отличная от других дистрибутивов работа с sudo, то отключена опция разрешения пользователям конфигурировать соединение, отключена опция разрешения пользователям управлять соединением, с вытекающими последствиями из-за sudo - отключена и не разрешается к выбору опция автозапуска интернета при старте системы в графике,

9) в openSUSE автозапуск демоном pppd(xl2tpd) без графики настраивается через /etc/init.d/after.local,

10) в openSUSE конфигуратор vpnpptp откажется конфигурировать соединение, если будет обнаружено dsl-соединение, а модуль ponoff откажется устанавливать соединение если будет обнаружено dsl-соединение,

11) в openSUSE вопрос использования любых DNS при поднятом VPN-соединении был решен специфически, иначе системой затирался бы файл /var/run/ppp/resolv.conf: при невыборе опции usepeerdns конфигуратор создает 2 идентичных файла /var/run/ppp/resolv.conf и /var/run/ppp/resolv.conf.copy - это позволяет модулю ponoff и модулю vpnpptp иметь свою собственную локальную реализацию работы с любыми DNS при поднятом соединении, в скрипт /etc/ppp/ip-up.d/ip-up добавляется: cp -f /var/run/ppp/resolv.conf.copy /var/run/ppp/resolv.conf, а у системы иметь другую глобальную реализацию работы с DNS, но заставляя систему использовать независимо от того dsl-соединение или нет приоритетно полученные от VPN-сервера DNS, что по сути правильно и необходимо если соединение с интернет реализовывается через демон pppd(xl2tpd) автозагрузкой при старте системы (или если не используется модуль ponoff для установления соединения),

12) добавлена возможность изменять размер шрифта, так как дефолтные настройки не всегда достаточны для слабозрячих: на пустом месте в окне конфигуратора нажатие левой кнопки мыши увеличивает шрифт, нажатие правой кнопки мыши уменьшает шрифт, шрифт сохраняется и при последующем конфигурировании будет измененный, во всплывающий хинт добавлена информация об этом,

13) добавлена поддержка дистрибутивов, родственных из числа поддерживаемых проектом - если дистрибутив не определился автоматически, то будет предложено его выбрать из выпадающего списка, если же дистрибутив определился, то выбор из списка будет запрещен во избежание шелудивых рук, так как неверный выбор многое собьет,

14) исправлен ряд недочетов, ускорен выход без аварии за счет улучшенной процедуры создания дефолтного шлюза,

15) если было введено хотя бы одно из детских DNS, то опция usepeerdns отключается автоматически, так как при этом имеются все разумные основания полагать желание пользователя настроить интернет для детей.

Примечания:

Тест проводился в openSUSE-11.3-DVD-i586 в виртуальной машине VmWare при настройках сети NAT и Bridge.
Конфигуратор vpnpptp для openSUSE изменяет настройку сети на более прогрессивное и правильное использование DNS для любых VPN-соединений, а не только для dsl-соединений, по своей сути vpnpptp является дополнительным инструментом к встроенным в дистрибутив openSUSE средствам настройки VPN, но может использоваться и автономно, и в сочетании с qinternet, kinternet. После выполнения изменений с помощью vpnpptp встроенное в openSUSE VPN будет работать лишь лучше и функциональнее - в дистрибутив перейдут для использования все настройки, сделанные vpnpptp, причем настройки затрагивают лишь файлы /etc/ppp/ip-up.d/ip-up, /etc/ppp/ip-down.d/ip-down, и создается директория /var/run/ppp/, которая вне зависимости от ее существования никак не влияет на openSUSE.
В openSUSE из-за политики дистрибутива был отключен некоторый второстепенный функционал программы, затрагивающий работу программы без пароля администратора, но отключенный функционал отключен временно и нисколько не мешает основной цели программы - настроить интернет и выйти в интернет.