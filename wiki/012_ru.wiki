#summary Возможности версии 0.1.2

В версии vpnpptp 0.1.2 реализовано:

1) в конфигураторе добавлены два поля: DNS1 до поднятия vpn и DNS2 до поднятия vpn - это dns, которые определяются автоматически из файла /etc/resolv.conf (это есть dns, полученные от DHCP-сервера или вручную указанные в настройках сетевого интерфейса); в конфигураторе эти DNS1 до поднятия vpn, DNS2 до поднятия vpn пока нельзя менять; смысл этих DNS1 до поднятия vpn и DNS2 до поднятия vpn следующий: они используются для поднятия vpn, они предоставляют ip-адрес vpn-сервера если он задан по имени, это локальные dns провайдера, то есть по умолчанию они доступны через локальную сеть, при поднятом vpn эти dns нами не используются, но они могут совпадать с DNS1 при поднятом vpn и/или DNS2 при поднятом vpn,

2) в конфигураторе добавлены еще два поля: DNS1 при поднятом vpn и DNS2 при поднятом vpn - это dns, которые будут использоваться при поднятом vpn если не была выбрана опция usepeerdns в опциях демона pppd, или если была выбрана опция usepeerdns в опциях демона pppd, но vpn-сервер не предоставил никаких других dns; в конфигураторе эти DNS1 при поднятом vpn, DNS2 при поднятом vpn можно менять, и это не отразится на файле /etc/resolv.conf; смысл этих DNS1 при поднятом vpn и DNS2 при поднятом vpn следующий: если не была выбрана опция usepeerdns демона pppd, то на этих DNS1 при поднятом vpn, DNS2 при поднятом vpn поднимается интерфейс pppN (или если опция usepeerdns демона pppd была выбрана, но vpn-сервер не предоставил dns, то на этих DNS1 при поднятом vpn, DNS2 при поднятом vpn поднимается интерфейс pppN), соответственно при выборе опции usepeerdns демона pppd эти DNS1 при поднятом vpn, DNS2 при поднятом vpn использоваться не будут лишь в случае если vpn-сервер предоставит свои dns;

3) DNS1 до поднятия vpn и DNS2 до поднятия vpn сохраняются в файле /opt/vpnpptp/config (также сохраняется и дополнительное DNS3 до поднятия vpn); DNS1 при поднятом vpn и DNS2 при поднятом vpn тоже сохраняются в файле /opt/vpnpptp/config,

4) в конфигураторе добавлена опция, позволяющая программно маршрутизировать dns - при выборе этой опции конфигуратор добавляет маршруты к DNS1 до поднятия vpn, DNS2 до поднятия vpn в шлюз локальной сети если не была выбрана опция запуска VPN PPTP в фоне, а если была выбрана опция запуска VPN PPTP в фоне, то DNS1 до поднятия vpn и DNS2 до поднятия vpn не маршрутизируются, а DNS1 при поднятом vpn и DNS2 при поднятом vpn маршрутизируются в шлюз, предоставленный vpn-сервером; при выборе этой опции если (DNS1 до поднятия vpn или DNS2 до поднятия vpn) совпадает с (DNS1 при поднятом vpn или DNS2 при поднятом vpn), то есть имеет место маршрутизация локального dns в шлюз локальной сети, то скорость открытия сайтов у многих пользователей увеличится; конфигуратор считает локальными лишь максимум 2 первых dns из файла /etc/resolv.conf, которые и определяются автоматически конфигуратором как DNS1 до поднятия vpn, DNS2 до поднятия vpn; то есть эта опция либо полезна (так как позволяет маршрутизировать локальные dns в шлюз локальной сети, а также маршрутизирует dns для работы с VPN PPTP в фоне посредством скриптов поднятия и опускания с использованием переменных в этих скриптах), либо бесполезна, но не вредна,

5) при выходе из ponoff при аварии и без аварии состояние настройки DNS-серверов возвращается к состоянию до поднятия vpn при любом исходе, так как модуль ponoff сохраняет текущее состояние dns при старте и возвращает его обратно при выходе,

6) немного поправлен механизм работы с sudo для случая обновления версий программы с vpnpptp-0.1.1 на более новую версию,

7) немного поправлен выход при аварии для опции встроенного в демон pppd реконнекта,

8) в конфигураторе теперь имеется опция проверки пинга DNS-сервера, и модуль ponoff при выборе этой опции будет проверять пинг DNS-серверов, выводя сообщения о проблеме, но в этой части программа еще не написана, поэтому пока модуль ponoff ничего проверять не будет,

9) конфигуратор при конфигурировании соединения теперь проверяет пинг DNS1 до поднятия vpn, DNS2 до поднятия vpn, о проблемах сообщается - таким образом проверяется техническая возможность поднятия vpn,

10) при старте конфигуратора теперь всегда перезапускается сеть, если не поднят pppN (а не только если нет дефолтного шлюза как было раньше) - это позволяет устранить целый ряд помех и ошибок при конфигурировании, так как многие параметры конфигуратор определяет автоматически на основе текущего состояния сети,

11) подмена /etc/resolv.conf и возможность задания произвольных dns серверов при поднятом pppN основана на особенностях демона pppd, который либо создает файл /var/run/ppp/resolv.conf, либо не создает - конфигуратор заносит в этот файл свои DNS1 при поднятом vpn, DNS2 при поднятом vpn (а также дополнительное DNS3 до поднятия vpn и все остальное, что идет далее в файле /etc/resolv.conf), и они либо изменяются демоном pppd, либо нет, что нам и нужно,

12) если была выбрана опция usepeerdns демона pppd, то файл /etc/resolv.conf изменяется скриптами /etc/ppp/ip-up.d/ip-up и /etc/ppp/ip-down.d/ip-down, используя файл /var/run/ppp/resolv.conf - в итоге при поднятом vpn-соединении адреса DNS-серверов, полученных от vpn-сервера становятся приоритетными; если не была выбрана опция usepeerdns демона pppd, то файл /etc/resolv.conf также изменяется скриптами /etc/ppp/ip-up.d/ip-up и /etc/ppp/ip-down.d/ip-down аналогично - в итоге при поднятом vpn-соединении становятся приоритетными DNS1 при поднятом vpn, DNS2 при поднятом vpn, заданные в конфигураторе,

13) возможность использования детских dns при поднятом vpn - они прямым текстом рекомендуются конфигуратором, чтобы их ввели,

14) самое главное - бесполезная ранее опция usepeerdns стала полезной, она сама по себе бесполезна до тех пор, пока программист не решит иначе,

15) в скрипте /etc/ppp/ip-up.d/ip-up строка /sbin/route add default dev ppp0 заменена на более универсальную строку /sbin/route add default dev $PPP_IFACE,

16) программа теперь работает с переменными в скриптах /etc/ppp/ip-up.d/ip-up, /etc/ppp/ip-down.d/ip-down, и это позволяет наиболее полно использовать информацию, поступающую от демона pppd, без необходимости задумываться об этой информации, и это позволяет увеличить точность алгоритма, а местами упростить сам код,

17) в конфигураторе добавлена кнопка, позволяющая скрывать и показывать пароль; по умолчанию пароль не показывается,

18) в конфигураторе добавлена кнопка Справка, вызывающая справку в картинках в формате doc.

Примечания:

Принято допущение при программной маршрутизации DNS1 до поднятия vpn и/или DNS2 до поднятия vpn в шлюз локальной сети, что настраиваемый провайдер имеет либо DNS1 до поднятия vpn, либо (DNS1 до поднятия vpn и DNS2 до поднятия vpn), однако то, что мы считаем DNS2 до поднятия vpn настраиваемого провайдера может принадлежать другому провайдеру, а наш провайдер может иметь лишь только одно DNS1 до поднятия vpn. Такое допущение допустимо, так как маршрутизация DNS-серверов действует лишь в период выхода в сеть через настроенное соединение, и эти маршруты убираются из таблицы маршрутизации как только пользователь выйдет из интернета, и таким образом это допущение практически не скажется на другом провайдере. К тому же конфигуратор позволяет не выбирать опцию программной маршрутизации DNS-серверов, и есть возможность в поле для ввода маршрутов для этого случая задать самостоятельно лишь маршрут DNS1-сервера до поднятия vpn в шлюз локальной сети, а также можно воспользоваться опцией usepeerdns демона pppd, поэтому принятое допущение допустимо для всех существующих провайдеров и их сочетаний.

Как следствие, исправлены недостатки работы операционной системы с dns-серверами - сейчас программа при поднятом pppN жестко привязана к введенным в конфигураторе DNS1 при поднятом vpn и DNS2 при поднятом vpn или при поднятом vpn реально использует dns-сервера, полученные от vpn-сервера, а потому ей все равно когда операционная система некорректно с ними работает - у программы теперь своя собственная реализация работы с /etc/resolv.conf.

Как следствие, если не была выбрана опция usepeerdns демона pppd (или была выбрана, но vpn-сервер не предоставил своих dns), то в конфигураторе можно задать в частности DNS1 при поднятом vpn:81.176.72.82, DNS2 при поднятом vpn:81.176.72.83 (http://netpolice.ru/filters/dns-filter/connect/) и таким образом все запросы к Интернет-ресурсам автоматически будут обрабатываться фильтром.
